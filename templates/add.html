{% extends "layout.html" %}

{% block title %}Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©{% endblock %}

{% block content %}
<style>
    .autocomplete-items {
        position: absolute; border: 1px solid #d4d4d4; border-bottom: none;
        border-top: none; z-index: 99; top: 100%; left: 0; right: 0;
    }
    .autocomplete-items div {
        padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover { background-color: #e9e9e9; }
</style>

<div class="card">
    <div class="card-header bg-primary text-white">
        <h3>ğŸ“ Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
    </div>
    <div class="card-body">
        <form action="/add" method="post" enctype="multipart/form-data">
            
            <div class="mb-3" style="position: relative;">
                <label for="supplier_name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ (Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø£Ùˆ Ù„Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯)</label>
                <input type="text" class="form-control" id="supplier_name" name="supplier_name" required autocomplete="off">
                <div id="supplier-suggestions"></div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="invoice_number" class="form-label">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                    <input type="text" class="form-control" id="invoice_number" name="invoice_number" required>
                </div>
                <div class="col-md-6 mb-3">
                     <label for="invoice_type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                     <input type="text" class="form-control" id="invoice_type" name="invoice_type" required>
                </div>
            </div>
             <div class="mb-3">
                <label for="category_name" class="form-label">Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©</label>
                <input type="text" class="form-control" id="category_name" name="category_name" required>
            </div>
            <div class="mb-3">
                <label for="invoice_date" class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                <input type="date" class="form-control" id="invoice_date" name="invoice_date" required>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="amount_pre_tax" class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¨Ø¯ÙˆÙ† Ø¶Ø±ÙŠØ¨Ø©)</label>
                    <input type="number" class="form-control" id="amount_pre_tax" name="amount_pre_tax" step="0.01" min="0" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="tax_amount" class="form-label">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (0 Ø¥Ù† Ù„Ù… ÙŠÙˆØ¬Ø¯)</label>
                    <input type="number" class="form-control" id="tax_amount" name="tax_amount" step="0.01" min="0" value="0" required>
                </div>
            </div>
            <div class="alert alert-info">
                <strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-amount">0.00</span> Ø±ÙŠØ§Ù„</strong>
            </div>
            <div class="mb-3">
                <label for="notes" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
            </div>
            <div class="mb-3">
                <label for="attachment" class="form-label">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (ØµÙˆØ±Ø©/PDF)</label>
                <input class="form-control" type="file" id="attachment" name="attachment" accept="image/*,.pdf">
            </div>

            <button type="submit" class="btn btn-success w-100">Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ 
    const amountInput = document.getElementById('amount_pre_tax');
    const taxInput = document.getElementById('tax_amount');
    const totalDisplay = document.getElementById('total-amount');

    function updateTotal() {
        const amount = parseFloat(amountInput.value) || 0;
        const tax = parseFloat(taxInput.value) || 0;
        totalDisplay.textContent = (amount + tax).toFixed(2);
    }
    amountInput.addEventListener('input', updateTotal);
    taxInput.addEventListener('input', updateTotal);
    updateTotal();

    // ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…ÙˆØ±Ø¯ (Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©)
    const supplierInput = document.getElementById('supplier_name');
    const suggestionsBox = document.getElementById('supplier-suggestions');

    supplierInput.addEventListener('keyup', async function() {
        const query = supplierInput.value;
        suggestionsBox.innerHTML = '';
        if (query.length < 2) return;

        const response = await fetch(`/api/search_suppliers?q=${query}`);
        const suppliers = await response.json();

        suppliers.forEach(supplier => {
            const div = document.createElement('div');
            div.textContent = supplier.name;
            div.addEventListener('click', function() {
                supplierInput.value = this.textContent;
                suggestionsBox.innerHTML = '';
            });
            suggestionsBox.appendChild(div);
        });
    });
</script>
{% endblock %}
